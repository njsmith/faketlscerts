[pytest]
addopts =
    # `pytest-xdist`:
    # -n auto  # we need to uncomment it once it's fixed
    # ^ this needs pytest-xdist to be actually installed

    # show 10 slowest invocations:
    --durations=10

    # a bit of verbosity doesn't hurt:
    -v

    # report all the things == -rxXs:
    -ra

    # tell pytest not to capture stdout
    -s

    # show values of the local vars in errors:
    --showlocals

    # autocollect and invoke the doctests from all modules:
    --doctest-modules

    # dump the test results in junit format:
    --junitxml=.test-results/pytest/results.xml

    # Fail on non-existing markers:
    --strict-markers

    # `pytest-cov`:
    --cov=trustme
    --cov=tests/
    --cov-config=.coveragerc
    --cov-report=xml:.test-results/pytest/cov.xml
doctest_optionflags = ALLOW_UNICODE ELLIPSIS
empty_parameter_set_mark = xfail
faulthandler_timeout = 30
filterwarnings =
    error
    # cryptography==3.0 warning:
    # `cryptography.utils.CryptographyDeprecationWarning` happens but we
    # cannot import it because of the chicken-egg nature of its
    # declaration. So we're forced to use its superclass that is in
    # fact, not a `DeprecationWarning` but a `UserWarning`.
    # Ref: https://github.com/pyca/cryptography/issues/5335
    ignore:Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in a future release.:UserWarning:cryptography
junit_duration_report = call
# pytest 6 makes xunit2 default but unlike xunit1 it does not contain the
# filename entries and so xunit1 is currently preferrable:
junit_family = xunit1
junit_logging = all
junit_log_passing_tests = true
junit_suite_name = trustme_test_suite
minversion = 4.6.3
norecursedirs =
    build
    ci
    dist
    docs
    newsfragments
    trustme.egg-info
    .cache
    .eggs
    .git
    .github
    .tox
    *.egg
testpaths = tests/
xfail_strict = true
